# CChess (Chinese Chess) GUI

这是我几年前学python的时候花了一个礼拜写的一个中国象棋程序，主要想用来打谱用，后来又加了人机对战和语音唱棋功能。当时写了一千多行代码，全部在一个文件里(cchess.py)。
最近想试一下coding agent的能力，于是尝试用codex重构了一下这个程序。前后加起来也就一个多小时的时间，
没想到重构的非常成功。本项目除了cchess.py,XQlightPy(第三方象棋AI库)和这段中文外，其他的都是codex生成的，有兴趣的可以对比一下。
留给程序员的时间不多了。

This is a Chinese chess (Xiangqi) program I wrote a few years ago when I was learning Python. I spent about a week on it at the time—originally I just wanted it for replaying and analyzing games. Later I added human-vs-AI and a voice feature that announces the moves. Back then it was over a thousand lines of code, all crammed into a single file (cchess.py).
Recently I wanted to test what coding agents can do, so I tried refactoring the program using Codex. The whole refactor—before and after—took just a little over an hour, and surprisingly it worked out extremely well. In this project, aside from cchess.py, XQlightPy (a third-party Xiangqi AI library), and this Chinese paragraph, everything else was generated by Codex. If you’re interested, feel free to compare the two versions.
There isn’t much time left for programmers.

<img width="969" height="879" alt="image" src="https://github.com/user-attachments/assets/8eeeb6fe-5451-46f2-9d57-0fc91579703b" />


This project is a modularized packaging of the original `cchess.py` into a standalone Python project. It provides a Turtle/Tkinter Chinese chess (Xiangqi) GUI with optional AI opponent and voice move input.

## Features
- Interactive Xiangqi board with legal move enforcement
- Move list display and replay from a text-based game record
- Human vs AI play using `XQlightPy`
- Optional voice input for moves (SpeechRecognition)

## Tech Stack
- Python 3.9+ (3.10+ recommended)
- Turtle + Tkinter for GUI rendering and UI widgets
- `SpeechRecognition` + `sounddevice` for voice input
- `numpy` for voice input and AI search

## Architecture
- `config.py` centralizes tunable board + AI settings.
- `state.py` owns app state containers (`GameState`, `UIState`) and the `CChessApp` lifecycle.
- `actions.py` holds game actions, move list interactions, and click handling.
- `ui_board.py` draws the board and command buttons.
- `ui_controls.py` builds the Tk controls and move list panes.
- `pieces.py` implements piece behavior, rules, and board initialization.
- `dependencies.py` isolates optional AI/voice imports so the app can degrade gracefully.

## Dataflow
1. `CChessApp.run()` wires the board, controls, and move lists, then registers click handlers.
2. User input events call `actions.click_move()` which updates `GameState`, board pieces, and move history.
3. Move history updates are reflected in the move list UI via `actions.display_moves()`.
4. If AI is enabled, the user move is pushed into the AI engine and `AIEngine.make_move()` generates the reply.
5. Voice input (if enabled) maps spoken moves into the same `actions.dapu_move()` flow.

## Project Layout
- `src/cchess_app/config.py`: board/AI configuration dataclasses
- `src/cchess_app/state.py`: app state containers + lifecycle
- `src/cchess_app/actions.py`: actions, move list logic, click handling
- `src/cchess_app/ui_board.py`: board + button drawing
- `src/cchess_app/ui_controls.py`: Tk controls + move lists
- `src/cchess_app/pieces.py`: piece class + board initialization
- `src/cchess_app/utils.py`: board geometry helpers
- `src/cchess_app/voice.py`: speech input handlers
- `src/cchess_app/ai.py`: AI move logic
- `src/cchess_app/dependencies.py`: optional imports for AI/voice
- `src/cchess_app/app.py`: entrypoint
- `src/XQlightPy/`: local engine dependency (copied from original project)

## Setup
From the project root:

```powershell
python -m cchess_app
```

On first run, the launcher will install missing voice dependencies if needed.


## Notes
- The AI engine is provided by the local `XQlightPy` package included with this project.
- Game record files should be plain text with moves formatted as in the original app.
